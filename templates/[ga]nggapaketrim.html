{% extends 'layout.html' %}

{% block title %}Input{% endblock %}

{% block content %}
<h2>Halaman Input</h2>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- <link type="text/css" href="@@path/vendor/sweetalert2/dist/sweetalert2.min.css" rel="stylesheet"> -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
  <!-- <script src="@@path/vendor/sweetalert2/dist/sweetalert2.all.min.js"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<div id="page-wrapper">
  <h4>Perhatikan Catatan Penting Berikut ini untuk Menginput Data!</h4>
  <hr>
  <h6>1. Berikut Tabel Komando Input Suara</h6>
  <img src="static/pic/itu.jpg" class="img-center" alt="Responsive image" style="max-width:50%;">
  <h6>2. Contoh Input Suara</h6>
  <p>"Posisi sayap BAWAH kemiringan sayap POSITIF bentuk sayap DELTA arah sayap LANCIP KEBELAKANG
    jenis mesin PISTON jumlah mesin SATU posisi mesin DEPAN bentuk badan TEBAL hidung badan BULAT tengah badan TABUNG
    posisi ekor DIATAS EKOR jumlah ekor TUNGGAL bentuk ekor OVAL persenjataan BERSENJATA warna POLOS"</h6>
  <h6>3. Hasil terletak di bagian bawah dan akan muncul setelah menekan tombol Run </p>
    <h6><i>**NB: Kalimat harus sesuai dengan contoh diatas**</i></h6>
    <hr>

    <!---------------------------------------------------SAYAP PESAWAT-------------------------------------------------->

    <h6>Klik tombol Start dibawah ini untuk memulai</h6>
    <p></p>
    <button class="btn btn-outline-success btn-block" type="button" onclick="startDictation('name')">Start</button>
    <button class="btn btn-outline-danger btn-block" type="button" id="stop-record" onclick="">Stop</button>
    <br>
    <hr>
    <h4>Sayap</h4>
    <br>
    <form method="POST" action="{{url_for('predict')}}">
      <label for="date">Posisi Sayap</label>
      <div class="input-group">
        <input name="posisi_sayap" type="text" class="form-control" id="posisi-sayap" placeholder="Isi..." aria-label="Isi..."
          aria-describedby="basic-addon2">
        <div class="input-group-append">
        </div>
      </div>
      <p></p>

      <label for="date">Kemiringan Sayap</label>
      <div class="input-group">
        <input name="kemiringan_sayap" type="text" class="form-control" id="kemiringan-sayap" placeholder="Isi..."
          aria-label="Isi..." aria-describedby="basic-addon2">
        <div class="input-group-append">
        </div>
      </div>
      <p></p>

      <label for="date">Bentuk Sayap</label>
      <div class="input-group">
        <input name="bentuk_sayap" type="text" class="form-control" id="bentuk-sayap" placeholder="Isi..." aria-label="Isi..."
          aria-describedby="basic-addon2">
        <div class="input-group-append">
        </div>
      </div>
      <p></p>

      <label for="date">Arah Sayap</label>
      <div class="input-group">
        <input name="arah_sayap" type="text" class="form-control" id="arah-sayap" placeholder="Isi..."
          aria-label="Isi..." aria-describedby="basic-addon2">
        <div class="input-group-append">
        </div>
      </div>
      <p></p>

      <!---------------------------------------------------MESIN PESAWAT-------------------------------------------------->
      <hr>
      <h4>Mesin</h4>
      <br>
      <label for="date">Jenis Mesin</label>
      <div class="input-group">
        <input name="jenis_mesin" type="text" class="form-control" id="jenis-mesin" placeholder="Isi..."
          aria-label="Isi..." aria-describedby="basic-addon2">
        <div class="input-group-append">
        </div>
      </div>
      <p></p>

      <label for="date">Jumlah Mesin</label>
      <div class="input-group">
        <input name="jumlah_mesin" type="text" class="form-control" id="jumlah-mesin" placeholder="Isi..."
          aria-label="Isi..." aria-describedby="basic-addon2">
        <div class="input-group-append">
        </div>
      </div>
      <p></p>

      <label for="date">Posisi Mesin</label>
      <div class="input-group">
        <input name="posisi_mesin" type="text" class="form-control" id="posisi-mesin" placeholder="Isi..."
          aria-label="Isi..." aria-describedby="basic-addon2">
        <div class="input-group-append">
        </div>
      </div>
      <p></p>

      <!---------------------------------------------------BADAN PESAWAT-------------------------------------------------->

      <hr>
      <h4>Badan</h4>
      <br>
      <label for="date">Bentuk Badan</label>
      <div class="input-group">
        <input name="bentuk_badan" type="text" class="form-control" id="bentuk-badan" placeholder="Isi..."
          aria-label="Isi..." aria-describedby="basic-addon2">
        <div class="input-group-append">
        </div>
      </div>
      <p></p>

      <label for="date">Hidung Badan</label>
      <div class="input-group">
        <input name="hidung_badan" type="text" class="form-control" id="hidung-badan" placeholder="Isi..."
          aria-label="Isi..." aria-describedby="basic-addon2">
        <div class="input-group-append">
        </div>
      </div>
      <p></p>

      <label for="date">Tengah Badan</label>
      <div class="input-group">
        <input name="tengah_badan" type="text" class="form-control" id="tengah-badan" placeholder="Isi..."
          aria-label="Isi..." aria-describedby="basic-addon2">
        <div class="input-group-append">
        </div>
      </div>
      <p></p>

      <!---------------------------------------------------EKOR PESAWAT--------------------------------------------------->

      <hr>
      <h4>Ekor</h4>
      <br>
      <label for="date">Posisi Ekor</label>
      <div class="input-group">
        <input name="posisi_ekor" type="text" class="form-control" id="posisi-ekor" placeholder="Isi..."
          aria-label="Isi..." aria-describedby="basic-addon2">
        <div class="input-group-append">
        </div>
      </div>
      <p></p>

      <label for="date">Jumlah Ekor</label>
      <div class="input-group">
        <input name="jumlah_ekor" type="text" class="form-control" id="jumlah-ekor" placeholder="Isi..."
          aria-label="Isi..." aria-describedby="basic-addon2">
        <div class="input-group-append">
        </div>
      </div>
      <p></p>

      <label for="date">Bentuk Ekor</label>
      <div class="input-group">
        <input name="bentuk_ekor" type="text" class="form-control" id="bentuk-ekor" placeholder="Isi..."
          aria-label="Isi..." aria-describedby="basic-addon2">
        <div class="input-group-append">
        </div>
      </div>
      <p></p>

      <!---------------------------------------------------WARNA PESAWAT-------------------------------------------------->
      <hr>
      <h4>Warna</h4>
      <br>
      <label for="date">Warna</label>
      <div class="input-group">
        <input name="warna" type="text" class="form-control" id="warna" placeholder="Isi..." aria-label="Isi..."
          aria-describedby="basic-addon2">
        <div class="input-group-append">
        </div>
      </div>
      <p></p>
      <hr>

      <!---------------------------------------------------NAMA PTTTA---------------------------------------------------->


      <!-- <h4>Asumsi Nama PTTA</h4> -->
      <!-- <br>
      <label for="date">Asumsi Nama PTTA</label>
      <div class="input-group">
        <input name="nama_ptta" type="text" class="form-control" id="asumsi" placeholder="Isi..." aria-label="Isi..."
          aria-describedby="basic-addon2">
        <div class="input-group-append">
        </div>
      </div>
      <p></p> -->
      <!-- <hr> -->
      <!------------------------------------------------------SELESAI----------------------------------------------------->

      <p><i>*Mohon dicek ulang agar tidak ada kesalahan</i></p>
      <hr>
      <h6>Apakah anda yakin untuk mengaksesnya?</h6>
      <p></p>
      <button type="submit" id="submit-hasil" class="btn btn-primary btn-block">Run</button>
    </form>
    <p></p>
    <hr>
    <div class="card text-center">
      <h6 class="card-header">Hasil</h6>
      <div class="card-body text-dark">
        <h5 class="card-text">Identifikasi :</h5>
        {% if identifikasi != 0 %}
        <p>{{identifikasi}}</p>
        {% else %}
        <p>0</p>
        {% endif %}

        <h5 class="card-text">Prediksi :</h5>
        {% if pred !=null %}
        <p>{{pred}}</p>
        {% else %}
        <p>0</p>
        {% endif %}

        <h5 class="card-text">Hamming Distance :</h5>
        {% if hm != null %}
        <p>Nilai: {{hm[1]}}</p>
        <p>Nama PTTA yang Mendekati: {{hm[0]}}</p>
        {% else %}
        <p>nilai: </p>
        <p>nama ptta: </p>
        {% endif %}
      </div>
    </div>

    <script>
      function startDictation(x) {
        Swal.fire({
          icon: 'warning',
          title: 'ATTENTION',
          text: 'Rekaman akan dimulai!',
          showConfirmButton: false,
          timer: 2000,
          timerProgressBar: true,
        })
        setTimeout(() => {
          if (window.hasOwnProperty('webkitSpeechRecognition')) {
            var recognition = new webkitSpeechRecognition();

            recognition.continuous = true;
            recognition.interimResults = false;

            recognition.lang = "id-ID";
            recognition.start();
            recognition.onresult = function (e) {
              // salah disini

              console.log(e);
              // var hasil = e.results[2][2].transcript.split('titik');
              // var hasil2 = hasil.join(' ');
              var hasil = e.results[0][0].transcript.split('titik')
              console.log(hasil);

              for (let i = 0; i < hasil.length; i++) {
                if (hasil[i].includes("posisi sayap")) {
                  document.getElementById('posisi-sayap').value = hasil[i].trim();

                } else if (hasil[i].includes("kemiringan sayap")) {
                  document.getElementById('kemiringan-sayap').value = hasil[i].trim();

                } else if (hasil[i].includes("bentuk sayap")) {
                  document.getElementById('bentuk-sayap').value = hasil[i].trim();

                } else if (hasil[i].includes("arah sayap")) {
                  document.getElementById('arah-sayap').value = hasil[i].trim();

                } else if (hasil[i].includes("jenis mesin")) {
                  document.getElementById('jenis-mesin').value = hasil[i].trim();

                } else if (hasil[i].includes("jumlah mesin")) {
                  document.getElementById('jumlah-mesin').value = hasil[i].trim();

                } else if (hasil[i].includes("posisi mesin")) {
                  document.getElementById('posisi-mesin').value = hasil[i].trim();

                } else if (hasil[i].includes("bentuk badan")) {
                  document.getElementById('bentuk-badan').value = hasil[i].trim();

                } else if (hasil[i].includes("hidung badan")) {
                  document.getElementById('hidung-badan').value = hasil[i].trim();

                } else if (hasil[i].includes("tengah badan")) {
                  document.getElementById('tengah-badan').value = hasil[i].trim();

                } else if (hasil[i].includes("posisi ekor")) {
                  document.getElementById('posisi-ekor').value = hasil[i].trim();

                } else if (hasil[i].includes("jumlah ekor")) {
                  document.getElementById('jumlah-ekor').value = hasil[i].trim();

                } else if (hasil[i].includes("bentuk ekor")) {
                  document.getElementById('bentuk-ekor').value = hasil[i].trim();

                } else if (hasil[i].includes("warna")) {
                  document.getElementById('warna').value = hasil[i].trim();
                }
              }

              // hasil = hasil.filter(function (hasil) {
              //   return hasil != null;
              // });
              // console.log(hasil);

              recognition.stop();
            };
            recognition.onerror = function (e) {
              recognition.stop();
            }

            var stop = document.getElementById("stop-record");
            
            stop.onclick = function(e){
              recognition.stop();
            }

          }
        }, 3000);
      }

      function hasil() {
        // var arah = document.getElementById('posisi').value;
        // var miring = document.getElementById('kemiringan').value;
        // var posisi = document.getElementById('bentuk').value;
        // var bentuk = document.getElementById('arah').value;

        // var jenis_mesin = document.getElementById('jenis').value;
        // var jumlah_mesin = document.getElementById('jumlah').value;
        // var posisi_mesin = document.getElementById('posisi').value;

        // var bentuk_badan = document.getElementById('bentuk').value;
        // var hidung_badan = document.getElementById('hidung').value;
        // var tengah_badan = document.getElementById('tengah').value;

        // var posisi_ekor = document.getElementById('posisi').value;
        // var jumlah_ekor = document.getElementById('jumlah').value;
        // var bentuk_ekor = document.getElementById('bentuk').value;

        // var warna = document.getElementById('warna').value;
        // // var persenjataan = document.getElementById('persenjataan').value;
        // var asumsi = document.getElementById('asumsi').value;

        // // var warna = document.getElementById('warna').value;
        // var hasil = "Posisi sayap " + arah + " kemiringan sayap " + miring + " posisi " + posisi + " bentuk sayap " + bentuk;
        // console.log(hasil);
        // document.getElementById('hasil').innerHTML = hasil;
      }
    </script>

</html>


{% endblock %}